mixin productCard(p)
    - const productId = p?.id || ''
    - const productSlug = p?.slug || ''
    - const productTitle = p?.title || 'Sản phẩm'
    - const thumbnail = p?.thumbnail || '/images/placeholder.jpg'
    - const hoverThumbnail = p?.hoverThumbnail || thumbnail
    - const sizes = Array.isArray(p?.sizes) ? p.sizes : []
    - const colors = Array.isArray(p?.colors) ? p.colors : []
    - const finalPriceText = p?.finalPriceText || ''
    - const originalPriceText = p?.originalPriceText || null
    - const hasDiscount = Boolean(p?.hasDiscount)
    - const discountPercent = typeof p?.discountPercent === 'number' ? p.discountPercent : 0
    - const priceForCart = typeof p?.priceForCart === 'number' ? p.priceForCart : 0

    .product-card(
        data-product-id=productId
        data-product-slug=productSlug
        data-product-title=productTitle
        data-product-price=priceForCart
        data-product-image=thumbnail
    )
        .thumb-wrap
            .thumb-ratio
                a.product-link(href=`/product/detail/${productSlug}` aria-label=productTitle)
                    img.product-thumb(src=thumbnail alt=productTitle loading="lazy")
                    if hoverThumbnail && hoverThumbnail !== thumbnail
                        img.product-thumb.product-thumb--hover(src=hoverThumbnail alt=productTitle loading="lazy")
            if sizes && sizes.length
                .quick-add(tabindex="0")
                    .quick-add__title
                        span Thêm nhanh vào giỏ hàng
                        span.quick-add__plus +
                    .quick-add__sizes
                        each s in sizes
                            button.quick-add__btn(type="button" data-size=s)= s

        if colors && colors.length
            .swatches
                each color, idx in colors
                    - const act = idx === 0 ? ' is-active' : ''
                    - const colorObj = color || {}
                    - const swatchRawName = typeof colorObj.name === 'string' ? colorObj.name : ''
                    - const swatchName = (swatchRawName && swatchRawName.trim()) ? swatchRawName : 'Màu khác'
                    - const colorHex = (typeof colorObj.hex === 'string' && colorObj.hex) ? colorObj.hex : ''
                    - const hasHex = !!colorHex
                    - const rawSwatchUrl = !hasHex && typeof colorObj.swatchUrl === 'string' ? colorObj.swatchUrl : ''
                    - const safeSwatchUrl = rawSwatchUrl ? String(rawSwatchUrl).replace(/'/g, "\\'") : ''
                    - const styleParts = []
                    - if (hasHex) styleParts.push(`--swatch-color:${colorHex}`)
                    - if (safeSwatchUrl) styleParts.push(`--swatch-image:url('${safeSwatchUrl}')`)
                    - if (!styleParts.length) styleParts.push(`--swatch-color:#1f2937`)
                    - const swatchStyle = styleParts.join(';')
                    button.swatch(
                        class=act
                        type="button"
                        data-color-name=swatchName
                        data-color=swatchName
                        data-color-hex=colorHex
                        data-color-swatch=safeSwatchUrl
                        style=swatchStyle
                    )
                        span.visually-hidden= swatchName

        .info
            a.title(href=`/product/detail/${productSlug}`)= productTitle
            .price-row
                if finalPriceText
                    span.final= finalPriceText
                if hasDiscount && discountPercent
                    span.discount-pill -#{discountPercent}%
                if hasDiscount && originalPriceText
                    span.old= originalPriceText

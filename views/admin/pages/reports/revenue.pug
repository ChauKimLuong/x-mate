extends ../../layouts/default

block content
  .dash-wrap
    // =============================
    // ðŸ’° REVENUE REPORT SECTION
    // =============================
    h2.welcome(style="font-weight:800;font-size:22px;") Revenue Report
    p(style="color:#6b7280;margin-bottom:20px;") View sales and revenue statistics for your store.

    if errorRevenue
      .alert(style="background:#fde8e8;color:#b42318;padding:10px 16px;border-radius:10px;margin-bottom:20px;")
        = errorRevenue

    form(method="get", action="/admin/reports/revenue", style="display:flex;gap:10px;align-items:center;margin-bottom:20px;flex-wrap:wrap;")
      label(for="from") From:
      input#from(type="date", name="from", value=from style="padding:6px 8px;border:1px solid #ccc;border-radius:8px;")
      label(for="to") To:
      input#to(type="date", name="to", value=to style="padding:6px 8px;border:1px solid #ccc;border-radius:8px;")
      label(for="status") Status:
      select#status(name="status", style="padding:6px 8px;border:1px solid #ccc;border-radius:8px;")
        option(value="All" selected=(status==="All")) All
        option(value="processing" selected=(status==="processing")) Processing (Paid / Shipped)
        option(value="completed" selected=(status==="completed")) Completed
        option(value="cancelled" selected=(status==="cancelled")) Cancelled
      button.btn-dark(type="submit" style="padding:10px 20px;font-size:16px;border-radius:25px;background:#333;color:#fff;border:none;cursor:pointer;")
        | Filter
      if orders.length
        a.btn(href=`/admin/reports/revenue/export?from=${from}&to=${to}&status=${status}`, style="background:#ff6a21;color:#fff;padding:8px 14px;border-radius:8px;margin-left:auto;") â¬‡ Export Excel

    if orders && orders.length
      .kpi-row(style="display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:24px;align-items:stretch;")
        .kpi-card(style="background:#fff4ee;padding:20px 24px;border-radius:20px;display:flex;flex-direction:column;justify-content:center;height:120px;")
          h4(style="margin:0 0 8px;color:#ff6a21;font-weight:600;") Total Revenue
          h2(style="margin:0;font-weight:800;font-size:22px;color:#111;") #{totalRevenue.toLocaleString('vi-VN')} Ä‘

        .kpi-card(style="background:#e8f8f4;padding:20px 24px;border-radius:20px;display:flex;flex-direction:column;justify-content:center;height:120px;")
          h4(style="margin:0 0 8px;color:#1f7a47;font-weight:600;") Completed Orders
          h2(style="margin:0;font-weight:800;font-size:22px;color:#111;") #{completed}

        .kpi-card(style="background:#f9fafb;padding:20px 24px;border-radius:20px;display:flex;flex-direction:column;justify-content:center;height:120px;")
          h4(style="margin:0 0 8px;color:#555;font-weight:600;") Processing Orders
          h2(style="margin:0;font-weight:800;font-size:22px;color:#111;") #{processing}

      // === Revenue Table ===
      table(style="width:100%;border-collapse:collapse;background:#fff;border-radius:16px;box-shadow:0 8px 24px rgba(16,24,40,0.06);overflow:hidden;")
        thead(style="background:#f9fafb;color:#555;")
          tr
            th(style="padding:12px;text-align:left;") Order ID
            th(style="text-align:center") Date
            th(style="text-align:center") Customer
            th(style="text-align:center") Email
            th(style="text-align:center") Total
            th(style="text-align:center") Status
        tbody
          each o in orders
            tr(style="border-top:1px solid #eee;")
              td(style="padding:10px 12px;")= o.id.slice(0,8)
              td(style="text-align:center")= new Date(o.createdAt).toLocaleDateString("vi-VN")
              // âœ… dÃ¹ng userName & userEmail thay vÃ¬ o.users
              td(style="text-align:center")= o.userName
              td(style="text-align:center")= o.userEmail
              td(style="text-align:center;color:#ff6a21;font-weight:600;") #{o.total.toLocaleString('vi-VN')} Ä‘
              td(style="text-align:center")
                if o.status === 'completed'
                  span(style="background:#e6f9ef;color:#1f7a47;padding:4px 10px;border-radius:8px;font-size:13px;font-weight:600;") âœ“ Completed
                else if ['paid','shipped'].includes(o.status)
                  span(style="background:#fff8e6;color:#b47a00;padding:4px 10px;border-radius:8px;font-size:13px;font-weight:600;") Processing
                else if o.status === 'cancelled'
                  span(style="background:#fde8e8;color:#b42318;padding:4px 10px;border-radius:8px;font-size:13px;font-weight:600;") Cancelled
                else
                  span(style="background:#f3f4f6;color:#555;padding:4px 10px;border-radius:8px;font-size:13px;font-weight:600;") #{o.status}
    else
      .empty(style="text-align:center;padding:40px;background:#fff;border-radius:16px;color:#888;box-shadow:0 4px 12px rgba(0,0,0,0.04);margin-bottom:30px;")
        p(style="margin:0;font-size:15px;") No orders found.

    // =============================
    // ðŸ“¦ INVENTORY REPORT SECTION
    // =============================
    h2.welcome(style="font-weight:800;font-size:22px;margin-top:40px;") Inventory Report
    p(style="color:#6b7280;margin-bottom:20px;") Track stock changes and sold quantities by time range, with category filtering.

    if errorInventory
      .alert(style="background:#fde8e8;color:#b42318;padding:10px 16px;border-radius:10px;margin-bottom:20px;")
        = errorInventory

    form(method="get", action="/admin/reports/inventory", style="display:flex;gap:10px;align-items:center;margin-bottom:20px;flex-wrap:wrap;")
      label(for="fromInv") From:
      input#fromInv(type="date", name="from", value=fromInv style="padding:6px 8px;border:1px solid #ccc;border-radius:8px;")
      label(for="toInv") To:
      input#toInv(type="date", name="to", value=toInv style="padding:6px 8px;border:1px solid #ccc;border-radius:8px;")
      label(for="cat") Category:
      select#cat(name="cat", style="padding:6px 8px;border:1px solid #ccc;border-radius:8px;")
        option(value="All" selected=(catId==="All")) All
        if categories
          each c in categories
            option(value=c.id selected=(catId===c.id))= c.title
      button.btn-dark(type="submit" style="padding:10px 20px;font-size:16px;border-radius:25px;background:#333;color:#fff;border:none;cursor:pointer;")
        | Filter

    // === Inventory KPI ===
    .kpi-row(style="display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:24px;align-items:stretch;")
      .kpi-card(style="background:#fff4ee;padding:20px 24px;border-radius:20px;")
          h4(style="color:#ff6a21;font-weight:600;") Total Product Types
          h2(style="font-weight:800;font-size:22px;") #{totalProductTypes}
      .kpi-card(style="background:#e8f8f4;padding:20px 24px;border-radius:20px;")
          h4(style="color:#1f7a47;font-weight:600;") Total Stock Remaining
          h2(style="font-weight:800;font-size:22px;") #{totalStockRemaining}
      .kpi-card(style="background:#f9fafb;padding:20px 24px;border-radius:20px;")
          h4(style="color:#555;font-weight:600;") Total Sold
          h2(style="font-weight:800;font-size:22px;") #{totalSold}

    // === Inventory Table ===
    if movements && movements.length
      table(style="width:100%;border-collapse:collapse;background:#fff;border-radius:16px;box-shadow:0 8px 24px rgba(16,24,40,0.06);overflow:hidden;")
        thead(style="background:#f9fafb;color:#555;")
          tr
            th(style="padding:12px;text-align:left;") Product ID
            th(style="text-align:center") Name
            th(style="text-align:center") Category
            th(style="text-align:center") Stock Remaining
            th(style="text-align:center") Sold
            th(style="text-align:center") Created At
        tbody
          each r in movements
            tr(style="border-top:1px solid #eee;")
              td(style="padding:10px 12px;")= r.id.slice(0,8)
              td(style="text-align:center")= r.title
              td(style="text-align:center")= r.category
              td(style="text-align:center;color:#1f7a47;font-weight:600;") #{r.stock}
              td(style="text-align:center;color:#b42318;font-weight:600;") #{r.sold}
              td(style="text-align:center")= new Date(r.createdAt).toLocaleDateString("vi-VN")
    else
      .empty(style="text-align:center;padding:40px;background:#fff;border-radius:16px;color:#888;")
        p No product data found for this filter.

block scripts
  script.
    console.log("Revenue + Inventory Reports loaded");

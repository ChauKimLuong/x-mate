extends ../../layouts/default

block content
  .dash-wrap
    // =============================
    // üí∞ REVENUE REPORT SECTION
    // =============================
    h2.welcome(style="font-weight:800;font-size:22px;") B√°o c√°o doanh thu
    p(style="color:#6b7280;margin-bottom:20px;") Xem th·ªëng k√™ b√°n h√†ng v√† doanh thu cho c·ª≠a h√†ng c·ªßa b·∫°n.

    if errorRevenue
      .alert(style="background:#fde8e8;color:#b42318;padding:10px 16px;border-radius:10px;margin-bottom:20px;")
        = errorRevenue

    form(method="get", action="/admin/reports/revenue", style="display:flex;gap:10px;align-items:center;margin-bottom:20px;flex-wrap:wrap;")
      label(for="from") T·ª´:
      input#from(type="date", name="from", value=from style="padding:6px 8px;border:1px solid #ccc;border-radius:8px;")
      label(for="to") ƒê·∫øn:
      input#to(type="date", name="to", value=to style="padding:6px 8px;border:1px solid #ccc;border-radius:8px;")
      label(for="status") Tr·∫°ng th√°i:
      select#status(name="status", style="padding:6px 8px;border:1px solid #ccc;border-radius:8px;")
        option(value="All" selected=(status==="All")) T·∫•t c·∫£
        option(value="processing" selected=(status==="processing")) ƒêang x·ª≠ l√Ω (ƒê√£ thanh to√°n / ƒê√£ giao)
        option(value="completed" selected=(status==="completed")) Ho√†n t·∫•t
        option(value="cancelled" selected=(status==="cancelled")) ƒê√£ h·ªßy
      button.btn-dark(type="submit" style="padding:10px 20px;font-size:16px;border-radius:25px;background:#333;color:#fff;border:none;cursor:pointer;")
        | L·ªçc
      if orders.length
        a.btn(href=`/admin/reports/revenue/export?from=${from}&to=${to}&status=${status}`, style="background:#ff6a21;color:#fff;padding:8px 14px;border-radius:8px;margin-left:auto;") ‚¨á Xu·∫•t Excel

    if orders && orders.length
      .kpi-row(style="display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:24px;align-items:stretch;")
        .kpi-card(style="background:#fff4ee;padding:20px 24px;border-radius:20px;display:flex;flex-direction:column;justify-content:center;height:120px;")
          h4(style="margin:0 0 8px;color:#ff6a21;font-weight:600;") T·ªïng doanh thu
          h2(style="margin:0;font-weight:800;font-size:22px;color:#111;") #{totalRevenue.toLocaleString('vi-VN')} ƒë

        .kpi-card(style="background:#e8f8f4;padding:20px 24px;border-radius:20px;display:flex;flex-direction:column;justify-content:center;height:120px;")
          h4(style="margin:0 0 8px;color:#1f7a47;font-weight:600;") ƒê∆°n h√†ng ho√†n t·∫•t
          h2(style="margin:0;font-weight:800;font-size:22px;color:#111;") #{completed}

        .kpi-card(style="background:#f9fafb;padding:20px 24px;border-radius:20px;display:flex;flex-direction:column;justify-content:center;height:120px;")
          h4(style="margin:0 0 8px;color:#555;font-weight:600;") ƒê∆°n h√†ng ƒëang x·ª≠ l√Ω
          h2(style="margin:0;font-weight:800;font-size:22px;color:#111;") #{processing}

      // === Revenue Table ===
      table(style="width:100%;border-collapse:collapse;background:#fff;border-radius:16px;box-shadow:0 8px 24px rgba(16,24,40,0.06);overflow:hidden;")
        thead(style="background:#f9fafb;color:#555;")
          tr
            th(style="padding:12px;text-align:left;") M√£ ƒë∆°n h√†ng
            th(style="text-align:center") Ng√†y
            th(style="text-align:center") Kh√°ch h√†ng
            th(style="text-align:center") Email
            th(style="text-align:center") T·ªïng
            th(style="text-align:center") Tr·∫°ng th√°i
        tbody
          each o in orders
            tr(style="border-top:1px solid #eee;")
              td(style="padding:10px 12px;")= o.id.slice(0,8)
              td(style="text-align:center")= new Date(o.createdAt).toLocaleDateString("vi-VN")
              // ‚úÖ d√πng userName & userEmail thay v√¨ o.users
              td(style="text-align:center")= o.userName
              td(style="text-align:center")= o.userEmail
              td(style="text-align:center;color:#ff6a21;font-weight:600;") #{o.total.toLocaleString('vi-VN')} ƒë
              td(style="text-align:center")
                if o.status === 'completed'
                  span(style="background:#e6f9ef;color:#1f7a47;padding:4px 10px;border-radius:8px;font-size:13px;font-weight:600;") Ho√†n t·∫•t
                else if ['paid','shipped'].includes(o.status)
                  span(style="background:#fff8e6;color:#b47a00;padding:4px 10px;border-radius:8px;font-size:13px;font-weight:600;") ƒêang x·ª≠ l√Ω
                else if o.status === 'cancelled'
                  span(style="background:#fde8e8;color:#b42318;padding:4px 10px;border-radius:8px;font-size:13px;font-weight:600;") ƒê√£ h·ªßy
                else
                  span(style="background:#f3f4f6;color:#555;padding:4px 10px;border-radius:8px;font-size:13px;font-weight:600;") #{o.status}
    else
      .empty(style="text-align:center;padding:40px;background:#fff;border-radius:16px;color:#888;box-shadow:0 4px 12px rgba(0,0,0,0.04);margin-bottom:30px;")
        p(style="margin:0;font-size:15px;") Kh√¥ng c√≥ ƒë∆°n h√†ng.

    // =============================
    // üì¶ INVENTORY REPORT SECTION
    // =============================
    h2.welcome(style="font-weight:800;font-size:22px;margin-top:40px;") B√°o c√°o t·ªìn kho
    p(style="color:#6b7280;margin-bottom:20px;") Theo d√µi bi·∫øn ƒë·ªông t·ªìn kho v√† s·ªë l∆∞·ª£ng b√°n theo th·ªùi gian, c√≥ l·ªçc theo danh m·ª•c.

    if errorInventory
      .alert(style="background:#fde8e8;color:#b42318;padding:10px 16px;border-radius:10px;margin-bottom:20px;")
        = errorInventory

    form(method="get", action="/admin/reports/inventory", style="display:flex;gap:10px;align-items:center;margin-bottom:20px;flex-wrap:wrap;")
      label(for="fromInv") T·ª´:
      input#fromInv(type="date", name="from", value=fromInv style="padding:6px 8px;border:1px solid #ccc;border-radius:8px;")
      label(for="toInv") ƒê·∫øn:
      input#toInv(type="date", name="to", value=toInv style="padding:6px 8px;border:1px solid #ccc;border-radius:8px;")
      label(for="cat") Danh m·ª•c:
      select#cat(name="cat", style="padding:6px 8px;border:1px solid #ccc;border-radius:8px;")
        option(value="All" selected=(catId==="All")) T·∫•t c·∫£
        if categories
          each c in categories
            option(value=c.id selected=(catId===c.id))= c.title
      button.btn-dark(type="submit" style="padding:10px 20px;font-size:16px;border-radius:25px;background:#333;color:#fff;border:none;cursor:pointer;")
        | L·ªçc

    // === Inventory KPI ===
    .kpi-row(style="display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:24px;align-items:stretch;")
      .kpi-card(style="background:#fff4ee;padding:20px 24px;border-radius:20px;")
          h4(style="color:#ff6a21;font-weight:600;") T·ªïng s·ªë lo·∫°i s·∫£n ph·∫©m
          h2(style="font-weight:800;font-size:22px;") #{totalProductTypes}
      .kpi-card(style="background:#e8f8f4;padding:20px 24px;border-radius:20px;")
          h4(style="color:#1f7a47;font-weight:600;") T·ªïng t·ªìn kho c√≤n l·∫°i
          h2(style="font-weight:800;font-size:22px;") #{totalStockRemaining}
      .kpi-card(style="background:#f9fafb;padding:20px 24px;border-radius:20px;")
          h4(style="color:#555;font-weight:600;") T·ªïng ƒë√£ b√°n
          h2(style="font-weight:800;font-size:22px;") #{totalSold}

    // === Inventory Table ===
    if movements && movements.length
      table(style="width:100%;border-collapse:collapse;background:#fff;border-radius:16px;box-shadow:0 8px 24px rgba(16,24,40,0.06);overflow:hidden;")
        thead(style="background:#f9fafb;color:#555;")
          tr
            th(style="padding:12px;text-align:left;") M√£ SP
            th(style="text-align:center") T√™n
            th(style="text-align:center") Danh m·ª•c
            th(style="text-align:center") T·ªìn c√≤n l·∫°i
            th(style="text-align:center") ƒê√£ b√°n
            th(style="text-align:center") T·∫°o l√∫c
        tbody
          each r in movements
            tr(style="border-top:1px solid #eee;")
              td(style="padding:10px 12px;")= r.id.slice(0,8)
              td(style="text-align:center")= r.title
              td(style="text-align:center")= r.category
              td(style="text-align:center;color:#1f7a47;font-weight:600;") #{r.stock}
              td(style="text-align:center;color:#b42318;font-weight:600;") #{r.sold}
              td(style="text-align:center")= new Date(r.createdAt).toLocaleDateString("vi-VN")
    else
      .empty(style="text-align:center;padding:40px;background:#fff;border-radius:16px;color:#888;")
        p Kh√¥ng c√≥ d·ªØ li·ªáu s·∫£n ph·∫©m cho b·ªô l·ªçc n√†y.

block scripts
  script.
    console.log("Revenue + Inventory Reports loaded");

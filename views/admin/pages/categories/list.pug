extends ../../layouts/default
include ../../mixins/icons

block head
  style.
    .pager-wrap{display:flex;justify-content:flex-end;margin:16px 0}
    .pager{display:flex;align-items:center;gap:0;border:1px solid #EAEDF1;border-radius:13px;overflow:hidden;background:#fff;box-shadow:0 2px 8px rgba(16,24,40,.04);margin-right:10px;margin-bottom:12px}
    .pager a,.pager span{padding:8px 14px;min-width:40px;justify-content:center;display:inline-flex;align-items:center;text-decoration:none;border-right:1px solid #eef0f5;color:#374151;background:#fff;font-weight:600}
    .pager a:hover{background:#f9fafb}
    .pager .active{background:#f97316;color:#fff;border-right-color:#f97316}
    .pager .disabled{color:#9ca3af;background:#f9fafb;pointer-events:none}
    .pager :last-child{border-right:none}

block content
  - const rows = Array.isArray(categories) && categories.length ? categories : []

  h2(style="margin:0 0 16px") CATEGORY LIST

  .card(style="padding:0;border-radius:18px;box-shadow:0 8px 24px rgba(16,24,40,.06)")
    .perf-hd
      .ttl All Categories
      .seg
        button.btn.btn-dark(onclick="location.href='/admin/categories/create'" style="background:#E6612A") Add Category

    table(style="width:100%; border-collapse:separate; border-spacing:0")
      thead
        tr
          th(style="text-align:left; padding:14px 16px; border-bottom:1px solid #eef0f5") Category
          th(style="text-align:left; padding:14px 16px; border-bottom:1px solid #eef0f5") Position
          th(style="text-align:left; padding:14px 16px; border-bottom:1px solid #eef0f5") Status
          th(style="text-align:left; padding:14px 16px; border-bottom:1px solid #eef0f5") Featured
          th(style="text-align:left; padding:14px 16px; border-bottom:1px solid #eef0f5") Action
      tbody
        if !rows.length
          tr
            td(colspan="5" style="padding:18px;text-align:center;color:#6b7280") No categories
        else
          each c in rows
            tr
              td(style="padding:14px 16px; border-top:1px solid #f2f3f7")
                .prodCell(style="display:flex; align-items:center; gap:14px")
                  img(src=c.thumbnail alt=c.title style="width:40px;height:40px;border-radius:10px;object-fit:cover;background:#f3f4f6")
                  .info
                    .name(style="font-weight:700")= c.title
                    .muted(style="color:#8c98a9; font-size:13px")= new Date(c.createdAt).toLocaleString()

              td(style="padding:14px 16px; border-top:1px solid #f2f3f7")= c.position
              td(style="padding:14px 16px; border-top:1px solid #f2f3f7")= c.status
              td(style="padding:14px 16px; border-top:1px solid #f2f3f7")= c.isFeatured ? 'Yes' : 'No'
              td(style="padding:14px 16px; border-top:1px solid #f2f3f7")
                .actions(style="display:flex; gap:8px; align-items:center")
                  a(href=`/admin/categories/${c.id}/edit` title="Edit" style="display:inline-flex;align-items:center;justify-content:center;width:36px;height:36px;border:1px solid #ffe0e0;border-radius:10px;background:#fff5f5")
                    +ic_edit()
                  form.delete-form(method="post" action=`/admin/categories/${c.id}/delete`)
                    button.btn-icon.btn-danger(
                      type="submit"
                      aria-label="Delete category"
                      data-confirm="Delete this category?"
                      style="display:inline-flex;align-items:center;justify-content:center;width:36px;height:36px;border:1px solid #ffe0e0;border-radius:10px;background:#fff5f5;cursor:pointer"
                    )
                      +ic_trash()

  - const totalPages = Math.max(1, Math.ceil((pagination?.total || 0) / (pagination?.take || 10)));
  - const cur = pagination?.page || 1;
  - const take = pagination?.take || 10;
  if !allMode && totalPages > 1
    nav.pager-wrap(aria-label="Pagination")
      .pager
        - const prev = Math.max(1, cur - 1);
        if cur > 1
          a(href=`?page=${prev}&take=${take}`) Previous
        else
          span.disabled Previous

        - for (let i = 1; i <= totalPages; i++) {
          if i === cur
            span.active= i
          else
            a(href=`?page=${i}&take=${take}`)= i
        - }

        - const next = Math.min(totalPages, cur + 1);
        if cur < totalPages
          a(href=`?page=${next}&take=${take}`) Next
        else
          span.disabled Next

block scripts
  script.
    (function(){
      document.addEventListener('click', function (e) {
        var del = e.target.closest && e.target.closest('form.delete-form button[type="submit"]');
        if (!del) return;
        var msg = del.getAttribute('data-confirm') || 'Are you sure?';
        if (!confirm(msg)) e.preventDefault();
      });
    })();

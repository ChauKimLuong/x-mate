extends ../../layouts/default
include ../../mixins/icons

block content
  - const KP = kpis || { totalOrders: 0, deals: 0, newLeads: 0, bookedRev: 0 }
  - const DL = deltas || { totalOrders: 0, deals: 0, newLeads: 0, bookedRev: 0 }
  - const pretty = (n) => Number(n || 0).toLocaleString()

  .dash-wrap
    h2.welcome Welcome

    .kpi-row
      // 4 KPI
      .kpi-card
        .ico-bg.peach
          +ic_bag()
        .meta
          .label Total Orders
          .value #{pretty(KP.totalOrders)}
        .delta
          if DL.totalOrders >= 0
            span.up ▲ #{DL.totalOrders}% 
            span.muted vs Last Month
          else
            span.down ▼ #{Math.abs(DL.totalOrders)}%
            span.muted vs Last Month

      .kpi-card
        .ico-bg.peach
          +ic_lock()
        .meta
          .label Deals
          .value #{pretty(KP.deals)}
        .delta
          if DL.deals >= 0
            span.up ▲ #{DL.deals}% 
            span.muted vs Last Month
          else
            span.down ▼ #{Math.abs(DL.deals)}%
            span.muted vs Last Month

      .kpi-card
        .ico-bg.peach
          +ic_userAdd()
        .meta
          .label New Leads
          .value #{pretty(KP.newLeads)}
        .delta
          if DL.newLeads >= 0
            span.up ▲ #{DL.newLeads}% 
            span.muted vs Last Month
          else
            span.down ▼ #{Math.abs(DL.newLeads)}%
            span.muted vs Last Month

      .kpi-card
        .ico-bg.peach
          +ic_coin()
        .meta
          .label Booked Revenue
          .value #{pretty(KP.bookedRev / 1000)}k đ
        .delta
          if DL.bookedRev >= 0
            span.up ▲ #{DL.bookedRev}% 
            span.muted vs Last Month
          else
            span.down ▼ #{Math.abs(DL.bookedRev)}%
            span.muted vs Last Month

    // Biểu đồ bên phải
    .perf-card
      .perf-hd
        .ttl Performance Overview
        .seg
          button(class=(period === "ALL" ? "on" : "") onclick="location.href='?period=ALL'") ALL
          button(class=(period === "1M" ? "on" : "") onclick="location.href='?period=1M'") 1M
          button(class=(period === "6M" ? "on" : "") onclick="location.href='?period=6M'") 6M
          button(class=(period === "1Y" ? "on" : "") onclick="location.href='?period=1Y'") 1Y
      .perf-bd
        canvas#perfChart(height="140")
      .legend
        .dot.orange
        span Booked Revenue
        .gap
        .dot.green
        span Completed Orders

block scripts
  script(src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js")
  script.
    window.__chart = {
      labels: !{JSON.stringify(labels)},
      views: !{JSON.stringify(seriesViews)},
      added: !{JSON.stringify(seriesAdded)},
      completed: !{JSON.stringify(seriesCompleted)}
    };
  script(src="/js/admin/admin-dashboard.js")
